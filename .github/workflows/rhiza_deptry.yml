# This file is part of the jebel-quant/rhiza repository
# (https://github.com/jebel-quant/rhiza).
#
# Workflow: Deptry
#
# Purpose: This workflow identifies missing and obsolete dependencies in the project.
#          It helps maintain a clean dependency tree by detecting unused packages and
#          implicit dependencies that should be explicitly declared.
#
# Trigger: This workflow runs on every push and on pull requests to main/master
#          branches (including from forks)

name: "DEPTRY"

# Permissions: Only read access to repository contents is needed
permissions:
    contents: read

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  deptry:
    name: Check dependencies with deptry
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/astral-sh/uv:0.9.24-python3.12-trixie

    steps:
      - uses: actions/checkout@v6

      - name: Run deptry
        run: make deptry
        # NOTE: make deptry is good style because it encapsulates the folders to check
        # (e.g. src and book/marimo) and keeps CI in sync with local development.
        # Since we use a 'uv' container, the Makefile is optimized to use the
        # pre-installed 'uv' and 'uvx' from the system PATH.
